{"version":3,"sources":["../../src/server/middleware/index.js"],"names":["log","attach","app","options","trace","extname","engine","set","viewsDir","graphQLRoute","ignoredMutations","contentSecurityPolicy","use","express","static","path","join","__dirname","publicDir","routes"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA;;;;;;;;;;AAUA;;;;;AAKA,MAAMA,GAAG,GAAG,qBAAa,YAAb,CAAZ;;AAEe,SAASC,MAAT,CAAgBC,GAAhB,EAAqBC,OAArB,EAA8B;AAC1CH,EAAAA,GAAG,CAACI,KAAJ,CAAU,8BAAV;AACA,QAAMC,OAAO,GAAG,MAAhB;AACAH,EAAAA,GAAG,CAACI,MAAJ,CAAWD,OAAX,EAAoB,gCAAiB;AAAEA,IAAAA;AAAF,GAAjB,CAApB;AACAH,EAAAA,GAAG,CAACK,GAAJ,CAAQ,aAAR,EAAuBF,OAAvB;AACAH,EAAAA,GAAG,CAACK,GAAJ,CAAQ,OAAR,EAAiBJ,OAAO,CAACK,QAAzB;AAEAR,EAAAA,GAAG,CAACI,KAAJ,CAAU,0BAAV;AACA,qBAAKF,GAAL,EAAUC,OAAO,CAACM,YAAlB,EAAgCN,OAAO,CAACO,gBAAxC;AACA,uBAAOR,GAAP,EAAYC,OAAO,CAACQ,qBAApB;AAEAX,EAAAA,GAAG,CAACI,KAAJ,CAAU,uCAAV;AACAF,EAAAA,GAAG,CAACU,GAAJ,CAAQ,2BAAR;AAEAZ,EAAAA,GAAG,CAACI,KAAJ,CAAU,iCAAV;AACAF,EAAAA,GAAG,CAACU,GAAJ,CAAQT,OAAO,CAACM,YAAhB,EAA8B,2CAA9B;AAEAT,EAAAA,GAAG,CAACI,KAAJ,CAAU,eAAV;AACAF,EAAAA,GAAG,CAACU,GAAJ,CAAQC,iBAAQC,MAAR,CAAeC,cAAKC,IAAL,CAAUC,SAAV,EAAqBd,OAAO,CAACe,SAA7B,CAAf,CAAR;AACAhB,EAAAA,GAAG,CAACU,GAAJ,CAAQO,eAAR;AACF","sourcesContent":["import express from 'express';\nimport compression from 'compression';\nimport { bodyParserGraphQL } from 'body-parser-graphql';\nimport handlebarsEngine from 'express-handlebars';\nimport path from 'path';\nimport helmet from './helmet';\nimport csrf from './csrf';\nimport routes from '../routes';\nimport createLogger from '../utils/logger';\n\n/**\n * @typedef MiddlewareOptions\n * @property {string} graphQLRoute\n * @property {Array<string>} ignoredMutations\n * @property {Array<string>} contentSecurityPolicy\n * @property {string} publicDir\n * @property {string} corsOrigins\n * @property {string} viewsDir\n */\n\n/**\n *\n * @param {Object} app\n * @param {MiddlewareOptions} options\n */\nconst log = createLogger('middleware');\n\nexport default function attach(app, options) {\n   log.trace('Configuring template engine.');\n   const extname = '.hbs';\n   app.engine(extname, handlebarsEngine({ extname }));\n   app.set('view engine', extname);\n   app.set('views', options.viewsDir);\n\n   log.trace('Adding security measures');\n   csrf(app, options.graphQLRoute, options.ignoredMutations);\n   helmet(app, options.contentSecurityPolicy);\n\n   log.trace('Adding automatic response compression');\n   app.use(compression());\n\n   log.trace('Configuring graphql body parser');\n   app.use(options.graphQLRoute, bodyParserGraphQL());\n\n   log.trace('Adding routes');\n   app.use(express.static(path.join(__dirname, options.publicDir)));\n   app.use(routes);\n}\n"],"file":"index.js"}